---
import { Profile } from '../components/Profile'
import { RecentPosts } from '../components/RecentPosts'
import Base from '../templates/Base.astro'
import { AppConfig } from '../utils/AppConfig'
import { sortByDate } from '../utils/Posts'

const response = await fetch('http://localhost:8080/posts')
const data = await response.json()
const allPosts = data.map((post: any) => ({
	frontmatter: {
		title: post.title,
		description: post.description,
		pubDate: post.pubDate,
		imgSrc: post.imgSrc,
		imgAlt: post.imgAlt,
		draft: post.draft,
	},
	url: `/posts/${post.id}`, // 게시물 URL 경로
	rawContent: '', // 실제 콘텐츠 데이터는 비워둠
	compiledContent: '', // 컴파일된 콘텐츠는 비워둠
}))
const sortedPosts = sortByDate(allPosts)
const lastThreePosts = sortedPosts.slice(0, 3)

const { title } = AppConfig
const { description } = AppConfig
---

<Base head={{ title, description }}>
	<Profile />
	<RecentPosts postList={lastThreePosts} />
</Base>
